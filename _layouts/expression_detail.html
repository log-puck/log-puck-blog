---
layout: default
---

{% assign expression_id = page.expression_id %}
{% assign expr_data = site.data.expression_detail[expression_id] %}

<div class="landing-page expression-detail-page">
  <!-- Header -->
  <section class="landing-header">
    <h1 class="landing-title">{{ expr_data.expression_id }}</h1>
    <p class="text-muted" style="font-size: 1.1rem; margin-top: 0.5rem;">
      {{ expr_data.info.language }}
    </p>
  </section>

  <!-- Expression Info -->
  <section class="landing-content">
    <div class="expression-info">
      <h3>Informazioni Expression</h3>
      <p><strong>Linguaggio:</strong> {{ expr_data.info.language }}</p>
      <p><strong>Runtime:</strong> {{ expr_data.info.runtime }}</p>
      <p><strong>Task:</strong> {{ expr_data.info.task }}</p>
      
      <!-- NUOVO: Link al nucleus -->
      {% if page.nucleus %}
      <p><strong>Nucleus:</strong> 
        <a href="{{ '/ob-ai/' | append: page.nucleus | append: '/' | relative_url }}" class="nucleus-link">
          {{ page.nucleus }}
        </a>
      </p>
      {% endif %}
    </div>

    <!-- Stats Aggregate -->
    <div class="expression-detail-stats">
      <h3>Statistiche Aggregate</h3>
      <div class="stats-grid">
        <div class="stat-box">
          <span class="stat-value">{{ expr_data.stats.total_runs }}</span>
          <span class="stat-label">Run totali</span>
        </div>
        <div class="stat-box">
          <span class="stat-value">{{ expr_data.stats.avg_time_ms | round: 1 }} <span class="unit">ms</span></span>
          <span class="stat-label">Tempo medio</span>
        </div>
        <div class="stat-box">
          <span class="stat-value tier-badge tier-{{ expr_data.stats.best_tier }}">{{ expr_data.stats.best_tier }}</span>
          <span class="stat-label">Best tier</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Timeline Esperimenti -->
  <section class="landing-content">
    <h2>Timeline Esperimenti</h2>
    <p class="text-muted" style="margin-bottom: 1.5rem;">
      Ultimi {{ expr_data.runs | size }} esperimenti (ordinati dal pi√π recente)
    </p>
    
    <div class="table-wrapper">
      <table class="expression-table">
        <thead>
          <tr>
            <th>ID Esperimento</th>
            <th>Timestamp</th>
            <th>Tier</th>
            <th>Tempo</th>
            <th>Output</th>
            <th>Sensazione</th>
          </tr>
        </thead>
        <tbody>
          {% for run in expr_data.runs %}
          <tr>
            <td><code>{{ run.id }}</code></td>
            <td>{{ run.timestamp | date: "%d/%m/%Y %H:%M" }}</td>
            <td>
              <span class="tier-badge tier-{{ run.tier_reached }}">{{ run.tier_reached }}</span>
            </td>
            <td>{{ run.time_ms }} ms</td>
            <td>{{ run.output_bytes }} bytes</td>
            <td class="sensation-cell">
              {% if run.sensation_json %}
                <!-- DATI REALI (quando ci sono) -->
                <div class="sensation-container">
                  <span class="sensation-indicator sensation-present" title="Click to view sensation data">üí≠</span>
                  <div class="sensation-popup">
                    <strong>Sensation Data</strong>
                    <pre><code>{{ run.sensation_json }}</code></pre>
                  </div>
                </div>
              {% else %}
                <!-- PLACEHOLDER (quando mancano) -->
                <div class="sensation-container">
                  <span class="sensation-indicator sensation-empty" title="No sensation data - Tier 6 feature">üí≠</span>
                  <div class="sensation-popup sensation-placeholder">
                    <strong>Sensation Data - Not Available</strong>
                    <p style="margin: 0.5rem 0; color: #999;">
                      This experiment doesn't have sensation metadata yet.
                    </p>
                    <p style="margin: 0; font-size: 0.85rem; color: #999;">
                      <em>Sensation tracking is a Tier 6 feature where AI generates subjective reports about task execution.</em>
                    </p>
                    <hr style="margin: 1rem 0; border: none; border-top: 1px solid #e0e0e0;">
                    <strong style="font-size: 0.9rem;">Example Format:</strong>
                    <pre style="margin-top: 0.5rem;"><code>{
  "mood": "focused",
  "flow": "smooth",
  "rsai": "Task completed efficiently"
}</code></pre>
                  </div>
                </div>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <!-- Back Link -->
  <section class="landing-content">
    <p style="text-align: center; margin-top: 2rem;">
      <a href="{{ '/waw/evolution/' | relative_url }}" class="btn-enter">‚Üê Torna a Evolution Dashboard</a>
    </p>
  </section>
</div>
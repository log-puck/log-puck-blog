<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="canonical" href="{{ site.url }}{{ site.baseurl }}{{ page.url }}" />
    <title>{% if page.title %}{{ page.title }}{% if page.title != site.title %} | {{ site.title }}{% endif %}{% else %}{{ site.title }}{% endif %}</title>
    <meta name="keywords" content="{% if page.keywords %}{{ page.keywords }}{% else %}{{ site.keywords }}{% endif %}">
    <meta name="description" content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
    
    {% comment %} Open Graph / Facebook {% endcomment %}
    <meta property="og:type" content="{% if page.url == '/' %}website{% else %}article{% endif %}">
    <meta property="og:url" content="{{ site.url }}{{ site.baseurl }}{{ page.url }}">
    <meta property="og:title" content="{% if page.title %}{{ page.title }}{% if page.title != site.title %} | {{ site.title }}{% endif %}{% else %}{{ site.title }}{% endif %}">
    <meta property="og:description" content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
    <meta property="og:site_name" content="{{ site.title }}">
    {% if page.og_image %}
    <meta property="og:image" content="{{ site.url }}{{ site.baseurl }}{{ page.og_image }}">
    {% endif %}
    
    {% comment %} Twitter Card {% endcomment %}
    <meta name="twitter:card" content="summary">
    <meta name="twitter:url" content="{{ site.url }}{{ site.baseurl }}{{ page.url }}">
    <meta name="twitter:title" content="{% if page.title %}{{ page.title }}{% if page.title != site.title %} | {{ site.title }}{% endif %}{% else %}{{ site.title }}{% endif %}">
    <meta name="twitter:description" content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
    {% if page.twitter_image %}
    <meta name="twitter:image" content="{{ site.url }}{{ site.baseurl }}{{ page.twitter_image }}">
    {% endif %}
    
    {% comment %} JSON-LD Structured Data {% endcomment %}
    {% if page.url == '/' %}
        {% comment %} Homepage: Organization + WebSite schema {% endcomment %}
        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@graph": [
                {
                    "@type": "Organization",
                    "name": "{{ site.title }}",
                    "url": "{{ site.url }}{{ site.baseurl }}",
                    "description": "{{ site.description | escape }}",
                    "logo": "{{ site.url }}{{ site.baseurl }}/assets/images/favicon.svg"
                },
                {
                    "@type": "WebSite",
                    "name": "{{ site.title }}",
                    "url": "{{ site.url }}{{ site.baseurl }}",
                    "description": "{{ site.description | escape }}",
                    "publisher": {
                        "@type": "Organization",
                        "name": "{{ site.title }}"
                    },
                    "potentialAction": {
                        "@type": "SearchAction",
                        "target": {
                            "@type": "EntryPoint",
                            "urlTemplate": "{{ site.url }}{{ site.baseurl }}/search?q={search_term_string}"
                        },
                        "query-input": "required name=search_term_string"
                    }
                }
            ]
        }
        </script>
    {% elsif page.date and page.layout != 'ob_progetti' and page.layout != 'ob_landing' and page.layout != 'ob_tag' %}
        {% comment %} Articoli/Blog Posts: Article schema {% endcomment %}
        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "{% if page.layout == 'ob_session' or page.layout == 'ob_document' %}BlogPosting{% else %}Article{% endif %}",
            "headline": "{{ page.title | escape }}",
            "description": "{{ page.description | default: site.description | escape }}",
            "url": "{{ site.url }}{{ site.baseurl }}{{ page.url }}",
            "datePublished": "{{ page.date | date: '%Y-%m-%d' }}",
            {% if page.date_modified %}
            "dateModified": "{{ page.date_modified | date: '%Y-%m-%d' }}",
            {% else %}
            "dateModified": "{{ page.date | date: '%Y-%m-%d' }}",
            {% endif %}
            "author": {
                "@type": "Organization",
                "name": "{{ site.title }}",
                "url": "{{ site.url }}{{ site.baseurl }}"
            },
            "publisher": {
                "@type": "Organization",
                "name": "{{ site.title }}",
                "logo": {
                    "@type": "ImageObject",
                    "url": "{{ site.url }}{{ site.baseurl }}/assets/images/favicon.svg"
                }
            },
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": "{{ site.url }}{{ site.baseurl }}{{ page.url }}"
            }
            {% if page.tags %}
            ,"keywords": "{{ page.tags | join: ', ' | escape }}"
            {% endif %}
        }
        </script>
    {% endif %}
    
    {% if page.url != '/' %}
        {% if page.section or page.subsection %}
        {% comment %} BreadcrumbList schema per pagine con breadcrumb {% endcomment %}
        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "BreadcrumbList",
            "itemListElement": [
                {
                    "@type": "ListItem",
                    "position": 1,
                    "name": "Home",
                    "item": "{{ site.url }}{{ site.baseurl }}/"
                }{% if page.section %},
                {
                    "@type": "ListItem",
                    "position": 2,
                    "name": "{{ page.section }}",
                    "item": "{{ site.url }}{{ site.baseurl }}/{{ page.section | downcase | replace: ' ', '-' }}/"
                }{% endif %}{% if page.subsection %},
                {
                    "@type": "ListItem",
                    "position": {% if page.section %}3{% else %}2{% endif %},
                    "name": "{{ page.subsection }}",
                    "item": "{{ site.url }}{{ site.baseurl }}/{{ page.section | downcase | replace: ' ', '-' }}/{{ page.subsection | downcase | replace: ' ', '-' }}/"
                }{% endif %}{% if page.title and page.title != page.subsection %},
                {
                    "@type": "ListItem",
                    "position": {% if page.subsection %}{% if page.section %}4{% else %}3{% endif %}{% else %}{% if page.section %}3{% else %}2{% endif %}{% endif %},
                    "name": "{{ page.title | escape }}",
                    "item": "{{ site.url }}{{ site.baseurl }}{{ page.url }}"
                }{% endif %}
            ]
        }
        </script>
        {% endif %}
    {% endif %}
    
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{{ '/assets/images/favicon.svg' | relative_url }}">
    <link rel="icon" type="image/svg+xml" sizes="16x16" href="{{ '/assets/images/favicon-16x16.svg' | relative_url }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ '/assets/images/apple-touch-icon.svg' | relative_url }}">
</head>

<body>

    <header class="site-header">
        <div class="container">
            <h1 class="logo"><a href="{{ '/' | relative_url }}">LOG_PUCK</a></h1>
            <nav class="main-nav">
                <button class="nav-toggle" aria-label="Toggle menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <ul class="nav-menu">
                    <li><a href="{{ '/ob-session/' | relative_url }}" class="nav-link {% if page.url contains '/ob-session/' %}active{% endif %}">OB-Session</a></li>
                    
                    <li class="nav-dropdown">
                        <a href="{{ '/ob-progetti/' | relative_url }}" class="nav-link {% if page.url contains '/ob-progetti/' %}active{% endif %}">
                            OB-Progetti <span class="dropdown-arrow">â–¼</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="{{ '/ob-progetti/musicaai/' | relative_url }}" {% if page.url contains '/ob-progetti/musicaai/' %}class="active"{% endif %}>Musica</a></li>
                            <li><a href="{{ '/ob-progetti/giochiai/' | relative_url }}" {% if page.url contains '/ob-progetti/giochiai/' %}class="active"{% endif %}>Giochi</a></li>
                            <li><a href="{{ '/ob-progetti/waw/' | relative_url }}" {% if page.url contains '/ob-progetti/waw/' %}class="active"{% endif %}>wAw</a></li>
                        </ul>
                    </li>
                    
                    <li><a href="{{ '/ob-ai/' | relative_url }}" class="nav-link {% if page.url contains '/ob-ai/' %}active{% endif %}">OB-AI</a></li>
                    <li><a href="{{ '/ob-archives/' | relative_url }}" class="nav-link {% if page.url contains '/ob-archives/' %}active{% endif %}">OB-Archivio</a></li>
                </ul>
            </nav>
        </div>
    </header>

    {% if page.url != '/' %}
    <div class="breadcrumb-wrapper">
        <div class="container">
            <nav class="breadcrumb">
                <a href="{{ '/' | relative_url }}">Home</a>
                {% if page.section %}
                <span class="separator">></span>
                <a href="{{ '/' | append: page.section | downcase | replace: ' ', '-' | append: '/' | relative_url }}">{{ page.section }}</a>
                {% endif %}
                {% if page.subsection %}
                <span class="separator">></span>
                <a href="{{ '/' | append: page.section | downcase | replace: ' ', '-' | append: '/' | append: page.subsection | downcase | replace: ' ', '-' | append: '/' | relative_url }}">{{ page.subsection }}</a>
                {% endif %}
                {% if page.title and page.title != page.subsection %}
                <span class="separator">></span>
                <span class="current">{{ page.title }}</span>
                {% endif %}
            </nav>
        </div>
    </div>
    {% endif %}

    <main>
        {{ content }}
    </main>

    <footer class="site-footer">
        <div class="container">
            <blockquote class="koan">
                Una volta un monaco chiese al maestro Joshu:<br>"Un cane possiede la natura di Buddha?" <br>
                Joshu rispose: <strong>MÃ¹! (ç„¡)</strong>
            </blockquote>
            
            <nav class="footer-nav">
                <a href="{{ '/about/' | relative_url }}">About</a> | 
                <a href="{{ '/legal/' | relative_url }}">Legal</a> | 
                <a href="{{ '/social/' | relative_url }}">Social</a>
            </nav>

            <div class="footer-meta">
                <p>&copy; 2025 LOG_PUCK â€” Built with AI Hurricane Modules</p>
            </div>
        </div>
    </footer>

    <script>
        // Mobile menu toggle
        const navToggle = document.querySelector('.nav-toggle');
        const navMenu = document.querySelector('.nav-menu');

        if (navToggle) {
            navToggle.addEventListener('click', () => {
                const isClosing = navToggle.classList.contains('active');
                
                navToggle.classList.toggle('active');
                navMenu.classList.toggle('active');
                
                // ðŸ‘ˆ NUOVO: Se stai chiudendo il menu, resetta dropdown
                if (isClosing && navDropdown) {
                    navDropdown.classList.remove('open');
                }
            });
        }

        // Mobile dropdown toggle
        const navDropdown = document.querySelector('.nav-dropdown');
        const dropdownLink = document.querySelector('.nav-dropdown > .nav-link');

        if (dropdownLink) {
            dropdownLink.addEventListener('click', (e) => {
                if (window.innerWidth <= 768) {
                    e.preventDefault();
                    navDropdown.classList.toggle('open'); // ðŸ‘ˆ Uso 'open' invece di 'active'
                }
            });
        }

        // Close mobile menu when clicking dropdown items
        const dropdownItems = document.querySelectorAll('.dropdown-menu a');
        dropdownItems.forEach(item => {
            item.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    navToggle.classList.remove('active');
                    navMenu.classList.remove('active');
                    navDropdown.classList.remove('open');
                }
            });
        });

        // Close mobile menu when clicking other nav items
        const mainNavLinks = document.querySelectorAll('.nav-menu > li > .nav-link');
        mainNavLinks.forEach(link => {
            if (!link.closest('.nav-dropdown')) { // Non il dropdown stesso
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        navToggle.classList.remove('active');
                        navMenu.classList.remove('active');
                    }
                });
            }
        });
        </script>
</body>
</html>